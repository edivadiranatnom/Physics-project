<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
    <svg id="mySVG" width="960" height="600">Porcodidio</svg>
</body>
<script>
    window.onload = function () {
        const width = window.innerWidth
        const height = window.innerHeight
        var nodes, links
        $.ajax({
            url: "http://localhost:8080/json",
            dataType: 'json',
            crossDomain: true,
            contentType: 'application/json; charset=utf-8',
            async: false,
            success: function (data) {
                data = JSON.parse(data)
                nodes = data.nodes
                links = data.links
            }
        });

        function getNodeColor(node) {
            return node.level === 1 ? 'red' : 'blue'
        }

        var svg = d3.select('svg').attr('width', width).attr('height', height)

        var linkForce = d3.forceLink()
            .id(function (link) {
                return link.id
            })
            .strength(function (link) {
                return link.strength
            })

        var simulation = d3.forceSimulation()
            .force('link', linkForce)
            .force('charge', d3.forceManyBody().strength(-1120))
            .force('center', d3.forceCenter(width / 2, height / 2))

        var linkElements = svg.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links).enter().append("line")
            .attr("stroke-width", 0.5)
            .attr("stroke", "black")

        var nodeElements = svg.append("g")
            .attr("class", "nodes")
            .selectAll("circle")
            .data(nodes)
            .enter().append("circle")
            .attr("r", 10)
            .attr("fill", getNodeColor)

        var textElements = svg.append("g")
            .attr("class", "texts")
            .selectAll("text")
            .data(nodes)
            .enter().append("text")
            .text(node => node.label)
            .attr("font-size", 10)
            .attr("dx", 15)
            .attr("dy", 4)

        simulation.nodes(nodes).on('tick', () => {
            nodeElements.attr('cx', function (node) {
                    return node.x
                })
                .attr('cy', function (node) {
                    return node.y
                })
            textElements.attr('x', function (node) {
                    return node.x
                })
                .attr('y', function (node) {
                    return node.y
                })
            linkElements.attr('x1', function (link) {
                    return link.source.x
                })
                .attr('y1', function (link) {
                    return link.source.y
                })
                .attr('x2', function (link) {
                    return link.target.x
                })
                .attr('y2', function (link) {
                    return link.target.y
                })
        })

        simulation.force("link").links(links)
    };
</script>

</html>